<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Aspira - Login</title>
    <link rel="icon" href="assets/aspira-logo.png" />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body class="auth-bg" style="background-image: url('assets/login-bg.png')">
    <div
      style="
        display: flex;
        min-height: 100vh;
        align-items: center;
        justify-content: center;
        padding: 20px;
      "
    >
      <div class="auth-card">
        <div style="text-align: center">
          <img
            src="assets/aspira-logo.png"
            alt="logo"
            style="width: 88px; margin-bottom: 12px"
          />
          <h2 style="margin: 0; color: var(--maroon)">Welcome back</h2>
          <p class="small">Sign in to your account</p>
        </div>
        <form id="loginForm" style="margin-top: 12px">
          <input
            class="input"
            id="email"
            type="email"
            placeholder="Email"
            required
          />
          <input
            class="input"
            id="password"
            type="password"
            placeholder="Password"
            required
          />
          <button class="btn" style="width: 100%; margin-top: 8px">
            Login
          </button>
        </form>
        <p class="small" style="margin-top: 12px">
          Don't have an account?
          <a href="register.html" style="color: var(--maroon)">Register</a>
        </p>

        <p class="small" style="margin-top: 8px;">
          Forgot your password?
          <a href="#" id="forgotLink" style="color: var(--maroon)">Forgot password?</a>
        </p>

        <!-- Forgot Password Modal -->
        <div id="forgotModal" 
            style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.5);
                    align-items:center; justify-content:center; z-index:9999;">
          <div style="background:#fff; padding:24px; border-radius:8px; width:100%; max-width:400px;">
            <h3 style="margin-top:0; color:var(--maroon)">Reset Password</h3>
            <p class="small">Enter a registered email address to reset your password.</p>
            <input id="resetEmail" class="input" type="email" placeholder="Email" required />
            <button id="resetBtn" class="btn" style="width:100%; margin-top:8px;">Send Reset Link</button>
            <button id="closeModal" class="btn" style="width:100%; margin-top:8px; background:#ccc; color:#333;">Cancel</button>
          </div>
        </div>

      </div>
    </div>
    <script>
      const API = "/api";
      document
        .getElementById("loginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;

          const res = await fetch(API + "/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password }),
          });

          const data = await res.json();

          if (res.ok) {
            localStorage.setItem("aspira_token", data.token);
            localStorage.setItem("aspira_user", JSON.stringify(data.user));
            console.log("Logged in user:", data.user);
            console.log("User role:", data.user.role);
            window.location.href =
              data.user.role === "teacher"
                ? "teacher-dashboard.html"
                : data.user.role === "admin"
                ? "admin-dashboard.html"
                : "student-dashboard.html";
          } else alert(data.msg || "Login failed");
        });

                  // === Forgot Password Logic ===
          const forgotLink = document.getElementById("forgotLink");
          const forgotModal = document.getElementById("forgotModal");
          const closeModal = document.getElementById("closeModal");
          const resetBtn = document.getElementById("resetBtn");

          forgotLink.addEventListener("click", () => (forgotModal.style.display = "flex"));
          closeModal.addEventListener("click", () => (forgotModal.style.display = "none"));

          resetBtn.addEventListener("click", async () => {
            const email = document.getElementById("resetEmail").value.trim();
            if (!email) return alert("Please enter your email");
            const res = await fetch(API + "/auth/forgot-password", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ email }),
            });
            const data = await res.json();
            alert(data.msg || "Check your email for password reset instructions.");
            forgotModal.style.display = "none";
          });

    </script>
  </body>
</html>
